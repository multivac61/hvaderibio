on:
  push:
    branches:
      - main
  pull_request:
  workflow_dispatch:
  schedule:
    - cron: "0 * * * *" # Run every hour
name: Deploy
jobs:
  build_and_deploy:
    runs-on: ubuntu-latest
    if: github.event_name != 'pull_request'
    steps:
      - uses: actions/checkout@main
      - uses: oven-sh/setup-bun@main

      - name: ğŸ“š Install node dependencies
        run: bun install

      - name: ğŸ¬ Scrape movie data
        run: bun scrape

      - name: â˜‘ï¸ Check svelte-kit, format and linting
        run: bun check

      - name: ğŸ”¨ Build for Cloudflare
        run: bun run build
        env:
          ADAPTER: cloudflare
          NODE_ENV: production

      - name: ğŸš€ Deploy to Cloudflare Pages
        run: bunx wrangler pages deploy .svelte-kit/cloudflare --project-name=hvaderibio
        env:
          CLOUDFLARE_API_TOKEN: ${{ secrets.CLOUDFLARE_API_TOKEN }}
          CLOUDFLARE_ACCOUNT_ID: ${{ secrets.CLOUDFLARE_ACCOUNT_ID }}
